(function(){function e(t,r){n(t),r=r||{};var i=this;this.key=t,this.config=e.Util.extend(e.getGlobalConfig(),r.cluster?e.getClusterConfig(r.cluster):{},r),this.channels=new e.Channels,this.global_emitter=new e.EventsDispatcher,this.sessionID=Math.floor(Math.random()*1e9),this.timeline=new e.Timeline(this.key,this.sessionID,{cluster:this.config.cluster,features:e.Util.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:e.Timeline.INFO,version:e.VERSION}),this.config.disableStats||(this.timelineSender=new e.TimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/jsonp"}));var s=function(t){var n=e.Util.extend({},i.config,t);return e.StrategyBuilder.build(e.getDefaultStrategy(n),n)};this.connection=new e.ConnectionManager(this.key,e.Util.extend({getStrategy:s,timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{encrypted:this.isEncrypted()})),this.connection.bind("connected",function(){i.subscribeAll(),i.timelineSender&&i.timelineSender.send(i.connection.isEncrypted())}),this.connection.bind("message",function(e){var t=e.event.indexOf("pusher_internal:")===0;if(e.channel){var n=i.channel(e.channel);n&&n.handleEvent(e.event,e.data)}t||i.global_emitter.emit(e.event,e.data)}),this.connection.bind("disconnected",function(){i.channels.disconnect()}),this.connection.bind("error",function(t){e.warn("Error",t)}),e.instances.push(this),this.timeline.info({instances:e.instances.length}),e.isReady&&i.connect()}function n(t){(t===null||t===undefined)&&e.warn("Warning","You must pass your app key when you instantiate Pusher.")}var t=e.prototype;e.instances=[],e.isReady=!1,e.debug=function(){if(!e.log)return;e.log(e.Util.stringify.apply(this,arguments))},e.warn=function(){var t=e.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(t):window.console.log&&window.console.log(t)),e.log&&e.log(t)},e.ready=function(){e.isReady=!0;for(var t=0,n=e.instances.length;t<n;t++)e.instances[t].connect()},t.channel=function(e){return this.channels.find(e)},t.allChannels=function(){return this.channels.all()},t.connect=function(){this.connection.connect();if(this.timelineSender&&!this.timelineSenderTimer){var t=this.connection.isEncrypted(),n=this.timelineSender;this.timelineSenderTimer=new e.PeriodicTimer(6e4,function(){n.send(t)})}},t.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},t.bind=function(e,t){return this.global_emitter.bind(e,t),this},t.bind_all=function(e){return this.global_emitter.bind_all(e),this},t.subscribeAll=function(){var e;for(e in this.channels.channels)this.channels.channels.hasOwnProperty(e)&&this.subscribe(e)},t.subscribe=function(e){var t=this.channels.add(e,this);return this.connection.state==="connected"&&t.subscribe(),t},t.unsubscribe=function(e){var t=this.channels.remove(e);this.connection.state==="connected"&&t.unsubscribe()},t.send_event=function(e,t,n){return this.connection.send_event(e,t,n)},t.isEncrypted=function(){return e.Util.getDocument().location.protocol==="https:"?!0:Boolean(this.config.encrypted)},e.HTTP={},this.Pusher=e}).call(this),function(){function e(e){window.clearTimeout(e)}function t(e){window.clearInterval(e)}function n(e,t,n,r){var i=this;this.clear=t,this.timer=e(function(){i.timer!==null&&(i.timer=r(i.timer))},n)}var r=n.prototype;r.isRunning=function(){return this.timer!==null},r.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},Pusher.Timer=function(t,r){return new n(setTimeout,e,t,function(e){return r(),null})},Pusher.PeriodicTimer=function(e,r){return new n(setInterval,t,e,function(e){return r(),e})}}.call(this),function(){Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(e){return new Pusher.Timer(0,e)},extend:function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n[r]&&n[r].constructor&&n[r].constructor===Object?e[r]=Pusher.Util.extend(e[r]||{},n[r]):e[r]=n[r]}return e},stringify:function(){var e=["Pusher"];for(var t=0;t<arguments.length;t++)typeof arguments[t]=="string"?e.push(arguments[t]):window.JSON===undefined?e.push(arguments[t].toString()):e.push(JSON.stringify(arguments[t]));return e.join(" : ")},arrayIndexOf:function(e,t){var n=Array.prototype.indexOf;if(e===null)return-1;if(n&&e.indexOf===n)return e.indexOf(t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},objectApply:function(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(e[n],n,e)},keys:function(e){var t=[];return Pusher.Util.objectApply(e,function(e,n){t.push(n)}),t},values:function(e){var t=[];return Pusher.Util.objectApply(e,function(e){t.push(e)}),t},apply:function(e,t,n){for(var r=0;r<e.length;r++)t.call(n||window,e[r],r,e)},map:function(e,t){var n=[];for(var r=0;r<e.length;r++)n.push(t(e[r],r,e,n));return n},mapObject:function(e,t){var n={};return Pusher.Util.objectApply(e,function(e,r){n[r]=t(e)}),n},filter:function(e,t){t=t||function(e){return!!e};var n=[];for(var r=0;r<e.length;r++)t(e[r],r,e,n)&&n.push(e[r]);return n},filterObject:function(e,t){var n={};return Pusher.Util.objectApply(e,function(r,i){if(t&&t(r,i,e,n)||Boolean(r))n[i]=r}),n},flatten:function(e){var t=[];return Pusher.Util.objectApply(e,function(e,n){t.push([n,e])}),t},any:function(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1},all:function(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0},method:function(e){var t=Array.prototype.slice.call(arguments,1);return function(n){return n[e].apply(n,t.concat(arguments))}},getWindow:function(){return window},getDocument:function(){return document},getNavigator:function(){return navigator},getLocalStorage:function(){try{return window.localStorage}catch(e){return undefined}},getClientFeatures:function(){return Pusher.Util.keys(Pusher.Util.filterObject({ws:Pusher.WSTransport,flash:Pusher.FlashTransport},function(e){return e.isSupported({})}))},addWindowListener:function(e,t){var n=Pusher.Util.getWindow();n.addEventListener!==undefined?n.addEventListener(e,t,!1):n.attachEvent("on"+e,t)},removeWindowListener:function(e,t){var n=Pusher.Util.getWindow();n.addEventListener!==undefined?n.removeEventListener(e,t,!1):n.detachEvent("on"+e,t)},isXHRSupported:function(){var e=window.XMLHttpRequest;return Boolean(e)&&(new e).withCredentials!==undefined},isXDRSupported:function(e){var t=e?"https:":"http:",n=Pusher.Util.getDocument().location.protocol;return Boolean(window.XDomainRequest)&&n===t}}}.call(this),function(){Pusher.VERSION="2.2.4",Pusher.PROTOCOL=7,Pusher.host="ws.pusherapp.com",Pusher.ws_port=80,Pusher.wss_port=443,Pusher.sockjs_host="sockjs.pusher.com",Pusher.sockjs_http_port=80,Pusher.sockjs_https_port=443,Pusher.sockjs_path="/pusher",Pusher.stats_host="stats.pusher.com",Pusher.channel_auth_endpoint="/pusher/auth",Pusher.channel_auth_transport="ajax",Pusher.activity_timeout=12e4,Pusher.pong_timeout=3e4,Pusher.unavailable_timeout=1e4,Pusher.cdn_http="http://js.pusher.com/",Pusher.cdn_https="https://js.pusher.com/",Pusher.dependency_suffix="",Pusher.getDefaultStrategy=function(e){var t;return e.encrypted?t=[":best_connected_ever",":ws_loop",[":delayed",2e3,[":http_fallback_loop"]]]:t=[":best_connected_ever",":ws_loop",[":delayed",2e3,[":wss_loop"]],[":delayed",5e3,[":http_fallback_loop"]]],[[":def","ws_options",{hostUnencrypted:e.wsHost+":"+e.wsPort,hostEncrypted:e.wsHost+":"+e.wssPort}],[":def","wss_options",[":extend",":ws_options",{encrypted:!0}]],[":def","sockjs_options",{hostUnencrypted:e.httpHost+":"+e.httpPort,hostEncrypted:e.httpHost+":"+e.httpsPort,httpPath:e.httpPath}],[":def","timeouts",{loop:!0,timeout:15e3,timeoutLimit:6e4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:e.activity_timeout}]],[":def","streaming_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:e.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","wss","ws",3,":wss_options",":ws_manager"],[":def_transport","flash","flash",2,":ws_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def_transport","xhr_streaming","xhr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xdr_streaming","xdr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xhr_polling","xhr_polling",1,":sockjs_options"],[":def_transport","xdr_polling","xdr_polling",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","wss_loop",[":sequential",":timeouts",":wss"]],[":def","flash_loop",[":sequential",":timeouts",":flash"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","streaming_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_streaming"],":xhr_streaming",":xdr_streaming"]]],[":def","polling_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_polling"],":xhr_polling",":xdr_polling"]]],[":def","http_loop",[":if",[":is_supported",":streaming_loop"],[":best_connected_ever",":streaming_loop",[":delayed",4e3,[":polling_loop"]]],[":polling_loop"]]],[":def","http_fallback_loop",[":if",[":is_supported",":http_loop"],[":http_loop"],[":sockjs_loop"]]],[":def","strategy",[":cached",18e5,[":first_connected",[":if",[":is_supported",":ws"],t,[":if",[":is_supported",":flash"],[":best_connected_ever",":flash_loop",[":delayed",2e3,[":http_fallback_loop"]]],[":http_fallback_loop"]]]]]]]}}.call(this),function(){Pusher.getGlobalConfig=function(){return{wsHost:Pusher.host,wsPort:Pusher.ws_port,wssPort:Pusher.wss_port,httpHost:Pusher.sockjs_host,httpPort:Pusher.sockjs_http_port,httpsPort:Pusher.sockjs_https_port,httpPath:Pusher.sockjs_path,statsHost:Pusher.stats_host,authEndpoint:Pusher.channel_auth_endpoint,authTransport:Pusher.channel_auth_transport,activity_timeout:Pusher.activity_timeout,pong_timeout:Pusher.pong_timeout,unavailable_timeout:Pusher.unavailable_timeout}},Pusher.getClusterConfig=function(e){return{wsHost:"ws-"+e+".pusher.com",httpHost:"sockjs-"+e+".pusher.com"}}}.call(this),function(){function e(e){var t=function(t){Error.call(this,t),this.name=e};return Pusher.Util.extend(t.prototype,Error.prototype),t}Pusher.Errors={BadEventName:e("BadEventName"),RequestTimedOut:e("RequestTimedOut"),TransportPriorityTooLow:e("TransportPriorityTooLow"),TransportClosed:e("TransportClosed"),UnsupportedTransport:e("UnsupportedTransport"),UnsupportedStrategy:e("UnsupportedStrategy")}}.call(this),function(){function e(e){this.callbacks=new n,this.global_callbacks=[],this.failThrough=e}function n(){this._callbacks={}}function r(e){return"_"+e}var t=e.prototype;t.bind=function(e,t,n){return this.callbacks.add(e,t,n),this},t.bind_all=function(e){return this.global_callbacks.push(e),this},t.unbind=function(e,t,n){return this.callbacks.remove(e,t,n),this},t.unbind_all=function(e,t){return this.callbacks.remove(e,t),this},t.emit=function(e,t){var n;for(n=0;n<this.global_callbacks.length;n++)this.global_callbacks[n](e,t);var r=this.callbacks.get(e);if(r&&r.length>0)for(n=0;n<r.length;n++)r[n].fn.call(r[n].context||window,t);else this.failThrough&&this.failThrough(e,t);return this},n.prototype.get=function(e){return this._callbacks[r(e)]},n.prototype.add=function(e,t,n){var i=r(e);this._callbacks[i]=this._callbacks[i]||[],this._callbacks[i].push({fn:t,context:n})},n.prototype.remove=function(e,t,n){if(!e&&!t&&!n){this._callbacks={};return}var i=e?[r(e)]:Pusher.Util.keys(this._callbacks);t||n?Pusher.Util.apply(i,function(e){this._callbacks[e]=Pusher.Util.filter(this._callbacks[e]||[],function(e){return t&&t!==e.fn||n&&n!==e.context}),this._callbacks[e].length===0&&delete this._callbacks[e]},this):Pusher.Util.apply(i,function(e){delete this._callbacks[e]},this)},Pusher.EventsDispatcher=e}.call(this),function(){function e(e,t){this.lastId=0,this.prefix=e,this.name=t}var t=e.prototype;t.create=function(e){this.lastId++;var t=this.lastId,n=this.prefix+t,r=this.name+"["+t+"]",i=!1,s=function(){i||(e.apply(null,arguments),i=!0)};return this[t]=s,{number:t,id:n,name:r,callback:s}},t.remove=function(e){delete this[e.number]},Pusher.ScriptReceiverFactory=e,Pusher.ScriptReceivers=new e("_pusher_script_","Pusher.ScriptReceivers")}.call(this),function(){function e(e){this.src=e}var t=e.prototype;t.send=function(e){var t=this,n="Error loading "+t.src;t.script=document.createElement("script"),t.script.id=e.id,t.script.src=t.src,t.script.type="text/javascript",t.script.charset="UTF-8",t.script.addEventListener?(t.script.onerror=function(){e.callback(n)},t.script.onload=function(){e.callback(null)}):t.script.onreadystatechange=function(){(t.script.readyState==="loaded"||t.script.readyState==="complete")&&e.callback(null)},t.script.async===undefined&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(t.errorScript=document.createElement("script"),t.errorScript.id=e.id+"_error",t.errorScript.text=e.name+"('"+n+"');",t.script.async=t.errorScript.async=!1):t.script.async=!0;var r=document.getElementsByTagName("head")[0];r.insertBefore(t.script,r.firstChild),t.errorScript&&r.insertBefore(t.errorScript,t.script.nextSibling)},t.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null},Pusher.ScriptRequest=e}.call(this),function(){function e(e){this.options=e,this.receivers=e.receivers||Pusher.ScriptReceivers,this.loading={}}var t=e.prototype;t.load=function(e,t,n){var r=this;if(r.loading[e]&&r.loading[e].length>0)r.loading[e].push(n);else{r.loading[e]=[n];var i=new Pusher.ScriptRequest(r.getPath(e,t)),s=r.receivers.create(function(t){r.receivers.remove(s);if(r.loading[e]){var n=r.loading[e];delete r.loading[e];var o=function(e){e||i.cleanup()};for(var u=0;u<n.length;u++)n[u](t,o)}});i.send(s)}},t.getRoot=function(e){var t,n=Pusher.Util.getDocument().location.protocol;return e&&e.encrypted||n==="https:"?t=this.options.cdn_https:t=this.options.cdn_http,t.replace(/\/*$/,"")+"/"+this.options.version},t.getPath=function(e,t){return this.getRoot(t)+"/"+e+this.options.suffix+".js"},Pusher.DependencyLoader=e}.call(this),function(){function e(){Pusher.ready()}function t(e){document.body?e():setTimeout(function(){t(e)},0)}function n(){t(e)}Pusher.DependenciesReceivers=new Pusher.ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers"),Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix,receivers:Pusher.DependenciesReceivers}),window.JSON?n():Pusher.Dependencies.load("json2",{},n)}(),function(){var e={encode:function(e){return f(u(e))}},t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={};for(var i=0,s=n.length;i<s;i++)r[n.charAt(i)]=i;var o=function(e){var n=e.charCodeAt(0);return n<128?e:n<2048?t(192|n>>>6)+t(128|n&63):t(224|n>>>12&15)+t(128|n>>>6&63)+t(128|n&63)},u=function(e){return e.replace(/[^\x00-\x7F]/g,o)},a=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),i=[n.charAt(r>>>18),n.charAt(r>>>12&63),t>=2?"=":n.charAt(r>>>6&63),t>=1?"=":n.charAt(r&63)];return i.join("")},f=window.btoa||function(e){return e.replace(/[\s\S]{1,3}/g,a)};Pusher.Base64=e}.call(this),function(){function e(e,t){this.url=e,this.data=t}function n(e){return Pusher.Util.mapObject(e,function(e){return typeof e=="object"&&(e=JSON.stringify(e)),encodeURIComponent(Pusher.Base64.encode(e.toString()))})}var t=e.prototype;t.send=function(e){if(this.request)return;var t=Pusher.Util.filterObject(this.data,function(e){return e!==undefined}),r=Pusher.Util.map(Pusher.Util.flatten(n(t)),Pusher.Util.method("join","=")).join("&"),i=this.url+"/"+e.number+"?"+r;this.request=new Pusher.ScriptRequest(i),this.request.send(e)},t.cleanup=function(){this.request&&this.request.cleanup()},Pusher.JSONPRequest=e}.call(this),function(){function e(e,t,n){this.key=e,this.session=t,this.events=[],this.options=n||{},this.sent=0,this.uniqueID=0}var t=e.prototype;e.ERROR=3,e.INFO=6,e.DEBUG=7,t.log=function(e,t){e<=this.options.level&&(this.events.push(Pusher.Util.extend({},t,{timestamp:Pusher.Util.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},t.error=function(t){this.log(e.ERROR,t)},t.info=function(t){this.log(e.INFO,t)},t.debug=function(t){this.log(e.DEBUG,t)},t.isEmpty=function(){return this.events.length===0},t.send=function(e,t){var n=this,r=Pusher.Util.extend({session:n.session,bundle:n.sent+1,key:n.key,lib:"js",version:n.options.version,cluster:n.options.cluster,features:n.options.features,timeline:n.events},n.options.params);return n.events=[],e(r,function(e,r){e||n.sent++,t&&t(e,r)}),!0},t.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},Pusher.Timeline=e}.call(this),function(){function e(e,t){this.timeline=e,this.options=t||{}}var t=e.prototype;t.send=function(e,t){var n=this;if(n.timeline.isEmpty())return;var r=function(t,r){var i="http"+(e?"s":"")+"://",s=i+(n.host||n.options.host)+n.options.path,o=new Pusher.JSONPRequest(s,t),u=Pusher.ScriptReceivers.create(function(e,t){Pusher.ScriptReceivers.remove(u),o.cleanup(),t&&t.host&&(n.host=t.host),r&&r(e,t)});o.send(u)};n.timeline.send(r,t)},Pusher.TimelineSender=e}.call(this),function(){function e(e){this.strategies=e}function n(e,t,n){var r=Pusher.Util.map(e,function(e,r,i,s){return e.connect(t,n(r,s))});return{abort:function(){Pusher.Util.apply(r,i)},forceMinPriority:function(e){Pusher.Util.apply(r,function(t){t.forceMinPriority(e)})}}}function r(e){return Pusher.Util.all(e,function(e){return Boolean(e.error)})}function i(e){!e.error&&!e.aborted&&(e.abort(),e.aborted=!0)}var t=e.prototype;t.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},t.connect=function(e,t){return n(this.strategies,e,function(e,n){return function(i,s){n[e].error=i;if(i){r(n)&&t(!0);return}Pusher.Util.apply(n,function(e){e.forceMinPriority(s.transport.priority)}),t(null,s)}})},Pusher.BestConnectedEverStrategy=e}.call(this),function(){function e(e,t,n){this.strategy=e,this.transports=t,this.ttl=n.ttl||18e5,this.encrypted=n.encrypted,this.timeline=n.timeline}function n(e){return"pusherTransport"+(e?"Encrypted":"Unencrypted")}function r(e){var t=Pusher.Util.getLocalStorage();if(t)try{var r=t[n(e)];if(r)return JSON.parse(r)}catch(i){s(e)}return null}function i(e,t,r){var i=Pusher.Util.getLocalStorage();if(i)try{i[n(e)]=JSON.stringify({timestamp:Pusher.Util.now(),transport:t,latency:r})}catch(s){}}function s(e){var t=Pusher.Util.getLocalStorage();if(t)try{delete t[n(e)]}catch(r){}}var t=e.prototype;t.isSupported=function(){return this.strategy.isSupported()},t.connect=function(e,t){var n=this.encrypted,o=r(n),u=[this.strategy];if(o&&o.timestamp+this.ttl>=Pusher.Util.now()){var a=this.transports[o.transport];a&&(this.timeline.info({cached:!0,transport:o.transport,latency:o.latency}),u.push(new Pusher.SequentialStrategy([a],{timeout:o.latency*2+1e3,failFast:!0})))}var f=Pusher.Util.now(),l=u.pop().connect(e,function c(r,o){r?(s(n),u.length>0?(f=Pusher.Util.now(),l=u.pop().connect(e,c)):t(r)):(i(n,o.transport.name,Pusher.Util.now()-f),t(null,o))});return{abort:function(){l.abort()},forceMinPriority:function(t){e=t,l&&l.forceMinPriority(t)}}},Pusher.CachedStrategy=e}.call(this),function(){function e(e,t){this.strategy=e,this.options={delay:t.delay}}var t=e.prototype;t.isSupported=function(){return this.strategy.isSupported()},t.connect=function(e,t){var n=this.strategy,r,i=new Pusher.Timer(this.options.delay,function(){r=n.connect(e,t)});return{abort:function(){i.ensureAborted(),r&&r.abort()},forceMinPriority:function(t){e=t,r&&r.forceMinPriority(t)}}},Pusher.DelayedStrategy=e}.call(this),function(){function e(e){this.strategy=e}var t=e.prototype;t.isSupported=function(){return this.strategy.isSupported()},t.connect=function(e,t){var n=this.strategy.connect(e,function(e,r){r&&n.abort(),t(e,r)});return n},Pusher.FirstConnectedStrategy=e}.call(this),function(){function e(e,t,n){this.test=e,this.trueBranch=t,this.falseBranch=n}var t=e.prototype;t.isSupported=function(){var e=this.test()?this.trueBranch:this.falseBranch;return e.isSupported()},t.connect=function(e,t){var n=this.test()?this.trueBranch:this.falseBranch;return n.connect(e,t)},Pusher.IfStrategy=e}.call(this),function(){function e(e,t){this.strategies=e,this.loop=Boolean(t.loop),this.failFast=Boolean(t.failFast),this.timeout=t.timeout,this.timeoutLimit=t.timeoutLimit}var t=e.prototype;t.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},t.connect=function(e,t){var n=this,r=this.strategies,i=0,s=this.timeout,o=null,u=function(a,f){f?t(null,f):(i+=1,n.loop&&(i%=r.length),i<r.length?(s&&(s*=2,n.timeoutLimit&&(s=Math.min(s,n.timeoutLimit))),o=n.tryStrategy(r[i],e,{timeout:s,failFast:n.failFast},u)):t(!0))};return o=this.tryStrategy(r[i],e,{timeout:s,failFast:this.failFast},u),{abort:function(){o.abort()},forceMinPriority:function(t){e=t,o&&o.forceMinPriority(t)}}},t.tryStrategy=function(e,t,n,r){var i=null,s=null;return n.timeout>0&&(i=new Pusher.Timer(n.timeout,function(){s.abort(),r(!0)})),s=e.connect(t,function(e,t){if(e&&i&&i.isRunning()&&!n.failFast)return;i&&i.ensureAborted(),r(e,t)}),{abort:function(){i&&i.ensureAborted(),s.abort()},forceMinPriority:function(e){s.forceMinPriority(e)}}},Pusher.SequentialStrategy=e}.call(this),function(){function e(e,t,n,r){this.name=e,this.priority=t,this.transport=n,this.options=r||{}}function n(e,t){return Pusher.Util.defer(function(){t(e)}),{abort:function(){},forceMinPriority:function(){}}}var t=e.prototype;t.isSupported=function(){return this.transport.isSupported({encrypted:this.options.encrypted})},t.connect=function(e,t){if(!this.isSupported())return n(new Pusher.Errors.UnsupportedStrategy,t);if(this.priority<e)return n(new Pusher.Errors.TransportPriorityTooLow,t);var r=this,i=!1,s=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),o=null,u=function(){s.unbind("initialized",u),s.connect()},a=function(){o=new Pusher.Handshake(s,function(e){i=!0,c(),t(null,e)})},f=function(e){c(),t(e)},l=function(){c(),t(new Pusher.Errors.TransportClosed(s))},c=function(){s.unbind("initialized",u),s.unbind("open",a),s.unbind("error",f),s.unbind("closed",l)};return s.bind("initialized",u),s.bind("open",a),s.bind("error",f),s.bind("closed",l),s.initialize(),{abort:function(){if(i)return;c(),o?o.close():s.close()},forceMinPriority:function(e){if(i)return;r.priority<e&&(o?o.close():s.close())}}},Pusher.TransportStrategy=e}.call(this),function(){function e(e,t,n){var r=e+(t.encrypted?"s":""),i=t.encrypted?t.hostEncrypted:t.hostUnencrypted;return r+"://"+i+n}function t(e,t){var n="/app/"+e,r="?protocol="+Pusher.PROTOCOL+"&client=js"+"&version="+Pusher.VERSION+(t?"&"+t:"");return n+r}Pusher.URLSchemes={ws:{getInitial:function(n,r){return e("ws",r,t(n,"flash=false"))}},flash:{getInitial:function(n,r){return e("ws",r,t(n,"flash=true"))}},sockjs:{getInitial:function(t,n){return e("http",n,n.httpPath||"/pusher","")},getPath:function(e,n){return t(e)}},http:{getInitial:function(n,r){var i=(r.httpPath||"/pusher")+t(n);return e("http",r,i)}}}}.call(this),function(){function e(e,t,n,r,i){Pusher.EventsDispatcher.call(this),this.hooks=e,this.name=t,this.priority=n,this.key=r,this.options=i,this.state="new",this.timeline=i.timeline,this.activityTimeout=i.activityTimeout,this.id=this.timeline.generateUniqueID()}var t=e.prototype;Pusher.Util.extend(t,Pusher.EventsDispatcher.prototype),t.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)},t.supportsPing=function(){return Boolean(this.hooks.supportsPing)},t.initialize=function(){var e=this;e.timeline.info(e.buildTimelineMessage({transport:e.name+(e.options.encrypted?"s":"")})),e.hooks.beforeInitialize&&e.hooks.beforeInitialize.call(e),e.hooks.isInitialized()?e.changeState("initialized"):e.hooks.file?(e.changeState("initializing"),Pusher.Dependencies.load(e.hooks.file,{encrypted:e.options.encrypted},function(t,n){e.hooks.isInitialized()?(e.changeState("initialized"),n(!0)):(t&&e.onError(t),e.onClose(),n(!1))})):e.onClose()},t.connect=function(){var e=this;if(e.socket||e.state!=="initialized")return!1;var t=e.hooks.urls.getInitial(e.key,e.options);try{e.socket=e.hooks.getSocket(t,e.options)}catch(n){return Pusher.Util.defer(function(){e.onError(n),e.changeState("closed")}),!1}return e.bindListeners(),Pusher.debug("Connecting",{transport:e.name,url:t}),e.changeState("connecting"),!0},t.close=function(){return this.socket?(this.socket.close(),!0):!1},t.send=function(e){var t=this;return t.state==="open"?(Pusher.Util.defer(function(){t.socket&&t.socket.send(e)}),!0):!1},t.ping=function(){this.state==="open"&&this.supportsPing()&&this.socket.ping()},t.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=undefined},t.onError=function(e){this.emit("error",{type:"WebSocketError",error:e}),this.timeline.error(this.buildTimelineMessage({error:e.toString()}))},t.onClose=function(e){e?this.changeState("closed",{code:e.code,reason:e.reason,wasClean:e.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=undefined},t.onMessage=function(e){this.emit("message",e)},t.onActivity=function(){this.emit("activity")},t.bindListeners=function(){var e=this;e.socket.onopen=function(){e.onOpen()},e.socket.onerror=function(t){e.onError(t)},e.socket.onclose=function(t){e.onClose(t)},e.socket.onmessage=function(t){e.onMessage(t)},e.supportsPing()&&(e.socket.onactivity=function(){e.onActivity()})},t.unbindListeners=function(){this.socket&&(this.socket.onopen=undefined,this.socket.onerror=undefined,this.socket.onclose=undefined,this.socket.onmessage=undefined,this.supportsPing()&&(this.socket.onactivity=undefined))},t.changeState=function(e,t){this.state=e,this.timeline.info(this.buildTimelineMessage({state:e,params:t})),this.emit(e,t)},t.buildTimelineMessage=function(e){return Pusher.Util.extend({cid:this.id},e)},Pusher.TransportConnection=e}.call(this),function(){function e(e){this.hooks=e}var t=e.prototype;t.isSupported=function(e){return this.hooks.isSupported(e)},t.createConnection=function(e,t,n,r){return new Pusher.TransportConnection(this.hooks,e,t,n,r)},Pusher.Transport=e}.call(this),function(){Pusher.WSTransport=new Pusher.Transport({urls:Pusher.URLSchemes.ws,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(window.WebSocket||window.MozWebSocket)},isSupported:function(){return Boolean(window.WebSocket||window.MozWebSocket)},getSocket:function(e){var t=window.WebSocket||window.MozWebSocket;return new t(e)}}),Pusher.FlashTransport=new Pusher.Transport({file:"flashfallback",urls:Pusher.URLSchemes.flash,handlesActivityChecks:!1,supportsPing:!1,isSupported:function(){try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){try{var t=Pusher.Util.getNavigator();return Boolean(t&&t.mimeTypes&&t.mimeTypes["application/x-shockwave-flash"]!==undefined)}catch(n){return!1}}},beforeInitialize:function(){window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR===undefined&&(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0),window.WEB_SOCKET_SWF_LOCATION=Pusher.Dependencies.getRoot({encrypted:this.options.encrypted})+"/WebSocketMain.swf"},isInitialized:function(){return window.FlashWebSocket!==undefined},getSocket:function(e){return new FlashWebSocket(e)}}),Pusher.SockJSTransport=new Pusher.Transport({file:"sockjs",urls:Pusher.URLSchemes.sockjs,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return window.SockJS!==undefined},getSocket:function(e,t){return new SockJS(e,null,{js_path:Pusher.Dependencies.getPath("sockjs",{encrypted:t.encrypted}),ignore_null_origin:t.ignoreNullOrigin})},beforeOpen:function(e,t){e.send(JSON.stringify({path:t}))}});var e={urls:Pusher.URLSchemes.http,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return Boolean(Pusher.HTTP.Socket)}},t=Pusher.Util.extend({getSocket:function(e){return Pusher.HTTP.getStreamingSocket(e)}},e),n=Pusher.Util.extend({getSocket:function(e){return Pusher.HTTP.getPollingSocket(e)}},e),r={file:"xhr",isSupported:Pusher.Util.isXHRSupported},i={file:"xdr",isSupported:function(e){return Pusher.Util.isXDRSupported(e.encrypted)}};Pusher.XHRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},t,r)),Pusher.XDRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},t,i)),Pusher.XHRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},n,r)),Pusher.XDRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},n,i))}.call(this),function(){function e(e,t,n){this.manager=e,this.transport=t,this.minPingDelay=n.minPingDelay,this.maxPingDelay=n.maxPingDelay,this.pingDelay=undefined}var t=e.prototype;t.createConnection=function(e,t,n,r){var i=this;r=Pusher.Util.extend({},r,{activityTimeout:i.pingDelay});var s=i.transport.createConnection(e,t,n,r),o=null,u=function(){s.unbind("open",u),s.bind("closed",a),o=Pusher.Util.now()},a=function(e){s.unbind("closed",a);if(e.code===1002||e.code===1003)i.manager.reportDeath();else if(!e.wasClean&&o){var t=Pusher.Util.now()-o;t<2*i.maxPingDelay&&(i.manager.reportDeath(),i.pingDelay=Math.max(t/2,i.minPingDelay))}};return s.bind("open",u),s},t.isSupported=function(e){return this.manager.isAlive()&&this.transport.isSupported(e)},Pusher.AssistantToTheTransportManager=e}.call(this),function(){function e(e){this.options=e||{},this.livesLeft=this.options.lives||Infinity}var t=e.prototype;t.getAssistant=function(e){return new Pusher.AssistantToTheTransportManager(this,e,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},t.isAlive=function(){return this.livesLeft>0},t.reportDeath=function(){this.livesLeft-=1},Pusher.TransportManager=e}.call(this),function(){function r(e){return function(t){return[e.apply(this,arguments),t]}}function s(e){return typeof e=="string"&&e.charAt(0)===":"}function o(e,t){return t[e.slice(1)]}function u(e,t){if(e.length===0)return[[],t];var n=l(e[0],t),r=u(e.slice(1),n[1]);return[[n[0]].concat(r[0]),r[1]]}function a(e,t){if(!s(e))return[e,t];var n=o(e,t);if(n===undefined)throw"Undefined symbol "+e;return[n,t]}function f(e,t){if(s(e[0])){var n=o(e[0],t);if(e.length>1){if(typeof n!="function")throw"Calling non-function "+e[0];var r=[Pusher.Util.extend({},t)].concat(Pusher.Util.map(e.slice(1),function(e){return l(e,Pusher.Util.extend({},t))[0]}));return n.apply(this,r)}return[n,t]}return u(e,t)}function l(e,t){var n=typeof e;return typeof e=="string"?a(e,t):typeof e=="object"&&e instanceof Array&&e.length>0?f(e,t):[e,t]}var e={build:function(e,t){var n=Pusher.Util.extend({},i,t);return l(e,n)[1].strategy}},t={ws:Pusher.WSTransport,flash:Pusher.FlashTransport,sockjs:Pusher.SockJSTransport,xhr_streaming:Pusher.XHRStreamingTransport,xdr_streaming:Pusher.XDRStreamingTransport,xhr_polling:Pusher.XHRPollingTransport,xdr_polling:Pusher.XDRPollingTransport},n={isSupported:function(){return!1},connect:function(e,t){var n=Pusher.Util.defer(function(){t(new Pusher.Errors.UnsupportedStrategy)});return{abort:function(){n.ensureAborted()},forceMinPriority:function(){}}}},i={extend:function(e,t,n){return[Pusher.Util.extend({},t,n),e]},def:function(e,t,n){if(e[t]!==undefined)throw"Redefining symbol "+t;return e[t]=n,[undefined,e]},def_transport:function(e,r,i,s,o,u){var a=t[i];if(!a)throw new Pusher.Errors.UnsupportedTransport(i);var f=(!e.enabledTransports||Pusher.Util.arrayIndexOf(e.enabledTransports,r)!==-1)&&(!e.disabledTransports||Pusher.Util.arrayIndexOf(e.disabledTransports,r)===-1)&&(r!=="flash"||e.disableFlash!==!0),l;f?l=new Pusher.TransportStrategy(r,s,u?u.getAssistant(a):a,Pusher.Util.extend({key:e.key,encrypted:e.encrypted,timeline:e.timeline,ignoreNullOrigin:e.ignoreNullOrigin},o)):l=n;var c=e.def(e,r,l)[1];return c.transports=e.transports||{},c.transports[r]=l,[undefined,c]},transport_manager:r(function(e,t){return new Pusher.TransportManager(t)}),sequential:r(function(e,t){var n=Array.prototype.slice.call(arguments,2);return new Pusher.SequentialStrategy(n,t)}),cached:r(function(e,t,n){return new Pusher.CachedStrategy(n,e.transports,{ttl:t,timeline:e.timeline,encrypted:e.encrypted})}),first_connected
:r(function(e,t){return new Pusher.FirstConnectedStrategy(t)}),best_connected_ever:r(function(){var e=Array.prototype.slice.call(arguments,1);return new Pusher.BestConnectedEverStrategy(e)}),delayed:r(function(e,t,n){return new Pusher.DelayedStrategy(n,{delay:t})}),"if":r(function(e,t,n,r){return new Pusher.IfStrategy(t,n,r)}),is_supported:r(function(e,t){return function(){return t.isSupported()}})};Pusher.StrategyBuilder=e}.call(this),function(){var e={};e.decodeMessage=function(e){try{var t=JSON.parse(e.data);if(typeof t.data=="string")try{t.data=JSON.parse(t.data)}catch(n){if(!(n instanceof SyntaxError))throw n}return t}catch(n){throw{type:"MessageParseError",error:n,data:e.data}}},e.encodeMessage=function(e){return JSON.stringify(e)},e.processHandshake=function(e){e=this.decodeMessage(e);if(e.event==="pusher:connection_established"){if(!e.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:e.data.socket_id,activityTimeout:e.data.activity_timeout*1e3}}if(e.event==="pusher:error")return{action:this.getCloseAction(e.data),error:this.getCloseError(e.data)};throw"Invalid handshake"},e.getCloseAction=function(e){return e.code<4e3?e.code>=1002&&e.code<=1004?"backoff":null:e.code===4e3?"ssl_only":e.code<4100?"refused":e.code<4200?"backoff":e.code<4300?"retry":"refused"},e.getCloseError=function(e){return e.code!==1e3&&e.code!==1001?{type:"PusherError",data:{code:e.code,message:e.reason||e.message}}:null},Pusher.Protocol=e}.call(this),function(){function e(e,t){Pusher.EventsDispatcher.call(this),this.id=e,this.transport=t,this.activityTimeout=t.activityTimeout,this.bindListeners()}var t=e.prototype;Pusher.Util.extend(t,Pusher.EventsDispatcher.prototype),t.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},t.send=function(e){return this.transport.send(e)},t.send_event=function(e,t,n){var r={event:e,data:t};return n&&(r.channel=n),Pusher.debug("Event sent",r),this.send(Pusher.Protocol.encodeMessage(r))},t.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},t.close=function(){this.transport.close()},t.bindListeners=function(){var e=this,t={message:function(t){var n;try{n=Pusher.Protocol.decodeMessage(t)}catch(r){e.emit("error",{type:"MessageParseError",error:r,data:t.data})}if(n!==undefined){Pusher.debug("Event recd",n);switch(n.event){case"pusher:error":e.emit("error",{type:"PusherError",data:n.data});break;case"pusher:ping":e.emit("ping");break;case"pusher:pong":e.emit("pong")}e.emit("message",n)}},activity:function(){e.emit("activity")},error:function(t){e.emit("error",{type:"WebSocketError",error:t})},closed:function(t){n(),t&&t.code&&e.handleCloseEvent(t),e.transport=null,e.emit("closed")}},n=function(){Pusher.Util.objectApply(t,function(t,n){e.transport.unbind(n,t)})};Pusher.Util.objectApply(t,function(t,n){e.transport.bind(n,t)})},t.handleCloseEvent=function(e){var t=Pusher.Protocol.getCloseAction(e),n=Pusher.Protocol.getCloseError(e);n&&this.emit("error",n),t&&this.emit(t)},Pusher.Connection=e}.call(this),function(){function e(e,t){this.transport=e,this.callback=t,this.bindListeners()}var t=e.prototype;t.close=function(){this.unbindListeners(),this.transport.close()},t.bindListeners=function(){var e=this;e.onMessage=function(t){e.unbindListeners();try{var n=Pusher.Protocol.processHandshake(t);n.action==="connected"?e.finish("connected",{connection:new Pusher.Connection(n.id,e.transport),activityTimeout:n.activityTimeout}):(e.finish(n.action,{error:n.error}),e.transport.close())}catch(r){e.finish("error",{error:r}),e.transport.close()}},e.onClosed=function(t){e.unbindListeners();var n=Pusher.Protocol.getCloseAction(t)||"backoff",r=Pusher.Protocol.getCloseError(t);e.finish(n,{error:r})},e.transport.bind("message",e.onMessage),e.transport.bind("closed",e.onClosed)},t.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},t.finish=function(e,t){this.callback(Pusher.Util.extend({transport:this.transport,action:e},t))},Pusher.Handshake=e}.call(this),function(){function e(e,t){Pusher.EventsDispatcher.call(this),this.key=e,this.options=t||{},this.state="initialized",this.connection=null,this.encrypted=!!t.encrypted,this.timeline=this.options.timeline,this.connectionCallbacks=this.buildConnectionCallbacks(),this.errorCallbacks=this.buildErrorCallbacks(),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var n=this;Pusher.Network.bind("online",function(){n.timeline.info({netinfo:"online"}),(n.state==="connecting"||n.state==="unavailable")&&n.retryIn(0)}),Pusher.Network.bind("offline",function(){n.timeline.info({netinfo:"offline"}),n.connection&&n.sendActivityCheck()}),this.updateStrategy()}var t=e.prototype;Pusher.Util.extend(t,Pusher.EventsDispatcher.prototype),t.connect=function(){if(this.connection||this.runner)return;if(!this.strategy.isSupported()){this.updateState("failed");return}this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()},t.send=function(e){return this.connection?this.connection.send(e):!1},t.send_event=function(e,t,n){return this.connection?this.connection.send_event(e,t,n):!1},t.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},t.isEncrypted=function(){return this.encrypted},t.startConnecting=function(){var e=this,t=function(n,r){n?e.runner=e.strategy.connect(0,t):r.action==="error"?(e.emit("error",{type:"HandshakeError",error:r.error}),e.timeline.error({handshakeError:r.error})):(e.abortConnecting(),e.handshakeCallbacks[r.action](r))};e.runner=e.strategy.connect(0,t)},t.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},t.disconnectInternally=function(){this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer();if(this.connection){var e=this.abandonConnection();e.close()}},t.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})},t.retryIn=function(e){var t=this;t.timeline.info({action:"retry",delay:e}),e>0&&t.emit("connecting_in",Math.round(e/1e3)),t.retryTimer=new Pusher.Timer(e||0,function(){t.disconnectInternally(),t.connect()})},t.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},t.setUnavailableTimer=function(){var e=this;e.unavailableTimer=new Pusher.Timer(e.options.unavailableTimeout,function(){e.updateState("unavailable")})},t.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},t.sendActivityCheck=function(){var e=this;e.stopActivityCheck(),e.connection.ping(),e.activityTimer=new Pusher.Timer(e.options.pongTimeout,function(){e.timeline.error({pong_timed_out:e.options.pongTimeout}),e.retryIn(0)})},t.resetActivityCheck=function(){var e=this;e.stopActivityCheck(),e.connection.handlesActivityChecks()||(e.activityTimer=new Pusher.Timer(e.activityTimeout,function(){e.sendActivityCheck()}))},t.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},t.buildConnectionCallbacks=function(){var e=this;return{message:function(t){e.resetActivityCheck(),e.emit("message",t)},ping:function(){e.send_event("pusher:pong",{})},activity:function(){e.resetActivityCheck()},error:function(t){e.emit("error",{type:"WebSocketError",error:t})},closed:function(){e.abandonConnection(),e.shouldRetry()&&e.retryIn(1e3)}}},t.buildHandshakeCallbacks=function(e){var t=this;return Pusher.Util.extend({},e,{connected:function(e){t.activityTimeout=Math.min(t.options.activityTimeout,e.activityTimeout,e.connection.activityTimeout||Infinity),t.clearUnavailableTimer(),t.setConnection(e.connection),t.socket_id=t.connection.id,t.updateState("connected",{socket_id:t.socket_id})}})},t.buildErrorCallbacks=function(){function t(t){return function(n){n.error&&e.emit("error",{type:"WebSocketError",error:n.error}),t(n)}}var e=this;return{ssl_only:t(function(){e.encrypted=!0,e.updateStrategy(),e.retryIn(0)}),refused:t(function(){e.disconnect()}),backoff:t(function(){e.retryIn(1e3)}),retry:t(function(){e.retryIn(0)})}},t.setConnection=function(e){this.connection=e;for(var t in this.connectionCallbacks)this.connection.bind(t,this.connectionCallbacks[t]);this.resetActivityCheck()},t.abandonConnection=function(){if(!this.connection)return;this.stopActivityCheck();for(var e in this.connectionCallbacks)this.connection.unbind(e,this.connectionCallbacks[e]);var t=this.connection;return this.connection=null,t},t.updateState=function(e,t){var n=this.state;this.state=e,n!==e&&(Pusher.debug("State changed",n+" -> "+e),this.timeline.info({state:e,params:t}),this.emit("state_change",{previous:n,current:e}),this.emit(e,t))},t.shouldRetry=function(){return this.state==="connecting"||this.state==="connected"},Pusher.ConnectionManager=e}.call(this),function(){function e(){Pusher.EventsDispatcher.call(this);var e=this;window.addEventListener!==undefined&&(window.addEventListener("online",function(){e.emit("online")},!1),window.addEventListener("offline",function(){e.emit("offline")},!1))}Pusher.Util.extend(e.prototype,Pusher.EventsDispatcher.prototype);var t=e.prototype;t.isOnline=function(){return window.navigator.onLine===undefined?!0:window.navigator.onLine},Pusher.NetInfo=e,Pusher.Network=new e}.call(this),function(){function e(){this.reset()}var t=e.prototype;t.get=function(e){return Object.prototype.hasOwnProperty.call(this.members,e)?{id:e,info:this.members[e]}:null},t.each=function(e){var t=this;Pusher.Util.objectApply(t.members,function(n,r){e(t.get(r))})},t.setMyID=function(e){this.myID=e},t.onSubscription=function(e){this.members=e.presence.hash,this.count=e.presence.count,this.me=this.get(this.myID)},t.addMember=function(e){return this.get(e.user_id)===null&&this.count++,this.members[e.user_id]=e.user_info,this.get(e.user_id)},t.removeMember=function(e){var t=this.get(e.user_id);return t&&(delete this.members[e.user_id],this.count--),t},t.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},Pusher.Members=e}.call(this),function(){function e(e,t){Pusher.EventsDispatcher.call(this,function(t,n){Pusher.debug("No callbacks on "+e+" for "+t)}),this.name=e,this.pusher=t,this.subscribed=!1}var t=e.prototype;Pusher.Util.extend(t,Pusher.EventsDispatcher.prototype),t.authorize=function(e,t){return t(!1,{})},t.trigger=function(e,t){if(e.indexOf("client-")!==0)throw new Pusher.Errors.BadEventName("Event '"+e+"' does not start with 'client-'");return this.pusher.send_event(e,t,this.name)},t.disconnect=function(){this.subscribed=!1},t.handleEvent=function(e,t){e.indexOf("pusher_internal:")===0?e==="pusher_internal:subscription_succeeded"&&(this.subscribed=!0,this.emit("pusher:subscription_succeeded",t)):this.emit(e,t)},t.subscribe=function(){var e=this;e.authorize(e.pusher.connection.socket_id,function(t,n){t?e.handleEvent("pusher:subscription_error",n):e.pusher.send_event("pusher:subscribe",{auth:n.auth,channel_data:n.channel_data,channel:e.name})})},t.unsubscribe=function(){this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},Pusher.Channel=e}.call(this),function(){function e(e,t){Pusher.Channel.call(this,e,t)}var t=e.prototype;Pusher.Util.extend(t,Pusher.Channel.prototype),t.authorize=function(e,t){var n=new Pusher.Channel.Authorizer(this,this.pusher.config);return n.authorize(e,t)},Pusher.PrivateChannel=e}.call(this),function(){function e(e,t){Pusher.PrivateChannel.call(this,e,t),this.members=new Pusher.Members}var t=e.prototype;Pusher.Util.extend(t,Pusher.PrivateChannel.prototype),t.authorize=function(e,t){var n=Pusher.PrivateChannel.prototype.authorize,r=this;n.call(r,e,function(e,n){if(!e){if(n.channel_data===undefined){Pusher.warn("Invalid auth response for channel '"+r.name+"', expected 'channel_data' field"),t("Invalid auth response");return}var i=JSON.parse(n.channel_data);r.members.setMyID(i.user_id)}t(e,n)})},t.handleEvent=function(e,t){switch(e){case"pusher_internal:subscription_succeeded":this.members.onSubscription(t),this.subscribed=!0,this.emit("pusher:subscription_succeeded",this.members);break;case"pusher_internal:member_added":var n=this.members.addMember(t);this.emit("pusher:member_added",n);break;case"pusher_internal:member_removed":var r=this.members.removeMember(t);r&&this.emit("pusher:member_removed",r);break;default:Pusher.PrivateChannel.prototype.handleEvent.call(this,e,t)}},t.disconnect=function(){this.members.reset(),Pusher.PrivateChannel.prototype.disconnect.call(this)},Pusher.PresenceChannel=e}.call(this),function(){function e(){this.channels={}}function n(e,t){return e.indexOf("private-")===0?new Pusher.PrivateChannel(e,t):e.indexOf("presence-")===0?new Pusher.PresenceChannel(e,t):new Pusher.Channel(e,t)}var t=e.prototype;t.add=function(e,t){return this.channels[e]||(this.channels[e]=n(e,t)),this.channels[e]},t.all=function(e){return Pusher.Util.values(this.channels)},t.find=function(e){return this.channels[e]},t.remove=function(e){var t=this.channels[e];return delete this.channels[e],t},t.disconnect=function(){Pusher.Util.objectApply(this.channels,function(e){e.disconnect()})},Pusher.Channels=e}.call(this),function(){Pusher.Channel.Authorizer=function(e,t){this.channel=e,this.type=t.authTransport,this.options=t,this.authOptions=(t||{}).auth||{}},Pusher.Channel.Authorizer.prototype={composeQuery:function(e){var t="socket_id="+encodeURIComponent(e)+"&channel_name="+encodeURIComponent(this.channel.name);for(var n in this.authOptions.params)t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(this.authOptions.params[n]);return t},authorize:function(e,t){return Pusher.authorizers[this.type].call(this,e,t)}};var e=1;Pusher.auth_callbacks={},Pusher.authorizers={ajax:function(e,t){var n=this,r;Pusher.XHR?r=new Pusher.XHR:r=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r.open("POST",n.options.authEndpoint,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var i in this.authOptions.headers)r.setRequestHeader(i,this.authOptions.headers[i]);return r.onreadystatechange=function(){if(r.readyState===4)if(r.status===200){var e,n=!1;try{e=JSON.parse(r.responseText),n=!0}catch(i){t(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+r.responseText)}n&&t(!1,e)}else Pusher.warn("Couldn't get auth info from your webapp",r.status),t(!0,r.status)},r.send(this.composeQuery(e)),r},jsonp:function(t,n){this.authOptions.headers!==undefined&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var r=e.toString();e++;var i=Pusher.Util.getDocument(),s=i.createElement("script");Pusher.auth_callbacks[r]=function(e){n(!1,e)};var o="Pusher.auth_callbacks['"+r+"']";s.src=this.options.authEndpoint+"?callback="+encodeURIComponent(o)+"&"+this.composeQuery(t);var u=i.getElementsByTagName("head")[0]||i.documentElement;u.insertBefore(s,u.firstChild)}}}.call(this);